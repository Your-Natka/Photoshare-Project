# =========================
# Базовий образ
# =========================
FROM python:3.12-slim
# Використовуємо мінімальний Python 3.12 образ, який легкий і швидкий

# =========================
# Робоча директорія всередині контейнера
# =========================
WORKDIR /app
# Всі наступні команди виконуються в /app

# =========================
# Встановлення системних залежностей
# =========================
# Бібліотеки для роботи з PostgreSQL
RUN apt-get update && apt-get install -y \
    build-essential \
    libpq-dev \
    && rm -rf /var/lib/apt/lists/*
# Очищаємо кеш apt після встановлення, щоб зменшити розмір образу

# =========================
# Копіюємо файл requirements та встановлюємо Python-залежності
# =========================
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
# --no-cache-dir запобігає збереженню кешу pip, зменшуючи розмір образу

# =========================
# Копіюємо весь код проекту
# =========================
COPY app ./app
COPY alembic ./alembic
COPY alembic.ini .
# Копіюємо директорію додатку, міграції Alembic та конфігураційний файл Alembic

# =========================
# Відкриваємо порт
# =========================
EXPOSE 8080
# FastAPI за замовчуванням слухає порт 8080

# =========================
# Команда запуску контейнера
# =========================
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8080"]
# Запуск FastAPI через Uvicorn, доступно з усіх IP адрес (0.0.0.0)
